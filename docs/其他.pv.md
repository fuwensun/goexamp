# Linux 文本处理三剑客，指的是 grep、awk 和 sed。掌握常见用法，就能大大提高开发效率

# git 跟踪分支和变基
将本地的 main 分支改成跟踪 upstream/main：
```
$ git fetch upstream
$ git branch --set-upstream-to=upstream/main main
```
一旦设置了跟踪分支，一定要变基（rebase）你的 main 分支，使它与上游仓库的任何新变化保持一致：
```
$ git remote update
$ git checkout main
$ git rebase
```

# 在使用 grpcurl 时，通过 -plaintext 参数忽略 tls 证书的验证过程

# go mod edit -replace=google.golang.org/grpc=github.com/grpc/grpc-go@latest

# URL 参数

路径参数有两个特殊符号":"和"*"

- ":" 跟在"/"后面为参数的key，匹配两个/中间的值 或 一个/到结尾(其中不再包含/)的值
- "*" 跟在"/"后面为参数的key，匹配从 /*开始到结尾的所有值，所有*必须写在最后且无法多个

GET("/param1/:name", pathParam)
可以拿到一个key为name的参数。注意只能匹配到/param1/felix，无法匹配/param1/felix/hao(该路径会404)

GET("/param2/:name/:value/:felid", pathParam)
可以拿到多个key参数。注意只能匹配到/param2/felix/hao/love，无法匹配/param2/felix或/param2/felix/hao

GET("/param3/:name/*action", pathParam)
可以拿到一个key为name的参数 和 一个key为action的路径。
如/params3/felix/hello，action的值为"/hello"
如/params3/felix/hello/hi，action的值为"/hello/hi"
如/params3/felix/hello/hi/，action的值为"/hello/hi/"

# swagger.json文件，可用于swagger工具通过WEBUI的方式打开使用

# attach 已过时，可用: docker exec -it containerID /bin/bash

# bash 工具

## sed

1. sed 大写改成小写

```
sed -i 's/[A-Z]/\l&/g'
```

2. sed 搜索复杂的字符串

```
//复杂的字符串 ("Int64(\"user_id\", user.Uid).")，
//先用 grep 测试是否可以搜索到(检测特殊字符串是否转义)，
//再用 sed 操作
grep -r "Int64(\"user_id\", user.Uid)." 
sed -i 's/Int64(\"user_id\", user.Uid).//g' $(grep -rl "user_id")
```

3. 搜索行，包含字符串 "Msgf(.* = %v"

```
sed '/Msgf(.* = %v/p' goms/internal/server/http/user.go
```

4. 搜索行，包含字符串Msgf，替换" = "为": " 

```
sed -i "/Msgf/ s/ = /: /g"  $(grep -rl "Msgf" --exclude-dir=.git)
```

## grep

1. --exclude-dir

```
grep -r "xxx" --exclude-dir={ .git,tools/env } // "tools/env" 被识别成目录，不是预期的结果
grep -r "xxx" --exclude-dir={ .git,env } // "env" 被识别成目录，是预期的结果
```

> Grep uses regex, but this looks like a glob.
# go error

下面等价
- err := errors.New("new err")
- err := fmt.Errorf("new err")

# 确保程序的正确性

- 测试
- 静态分析

# git commit test\chore

test 包含 ut\bt\it 和 tests 目录下
chore 包含 build(makefile)\cicd(workflow)\tools\git-hook\...

# git reset\git checkout -- .

git reset 从 history 区重置 cached 区
git checkout -- . 从 cached 区重置 work 区

# git 批量处理改动的文件

1. 列出改动的文件
git st | awk '{ print $2 }'

2. grep 关注的文件
git st | awk '{ print $2 }' | grep _test.go

# goimports 处理 go 文件，排除 pb.go 和 mock.go 之类的生成文件
goimports -w $(find . -name "*.go" | grep -v pb.go | grep -v mock.go)

# git 分支管理
git br | grep m.bk[2-9] | xargs git br -D

# docker image

REPO_ADDR:=$(REGISTRY_ADDR)/$(NAME_SPACE)/$(REPO_NAME)
REPO:=$(REGISTRY_ADDR)/$(NAME_SPACE)/$(REPO_NAME)
IMAGE:=$(REPO_ADDR):$(TAG)
IMAGE:=$(REGISTRY_ADDR)/$(NAME_SPACE)/$(REPO_NAME):$(TAG)
IMAGE:=$(NAME_SPACE)/$(REPO_NAME):$(TAG)

dockerxpub/goms-edocker:v1
https://hub.docker.com/repositories/dockerxpub/goms-edocker:v1
https://registry-vpc.cn-shenzhen.aliyuncs.com/dockerxpub/goms-edocker:v1

# bash 变量引用

引用指将字符串用引用符号引起来，以防止特殊字符被 shell 脚本重解释为其他意义
shell 中定义了四种引用符号

- **双引号("xx")** 又称**部分引** 引用除美圆符号($)、反引号(`)和反斜线(\)之外的所有字符，即 ($ ` \) 在双引号中仍被解释为特殊意义，利用双引号引用变量能防止字符串分割，而保留变量中的空格。

- **单引号('xx')** 又称**全引用**，单引号中字符都解释为字面意义，不再具备引用变量的功能。

- **反引号(`xx`)** 命令替换（将命令的标准输出作为值），等价于$(). $() 形式的命令替换是可以嵌套的。如`pwd`和$(pwd)等价都为当前工作目录。反引号与 $() 在处理双反斜线时存在区别
  - 反引号将反斜线符号处理为空格
  - $() 符号将其处理为单斜线符

- **反斜线(\)** 表示转义，将屏蔽下一字符的原来意义
  - 特殊字符转成字面意思: 取问号(\?),取反斜线(\\)
  - 普通字符转成其他含义：如控制字符(\t),ascii码(\0x22)

# bash 文件名和后缀

```
file=”thisfile.txt”
echo “filename: ${file%.*}”
ech`o “extension: ${file##*.}” 
```